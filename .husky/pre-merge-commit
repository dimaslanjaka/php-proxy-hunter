#!/bin/bash

# Determine the current script directory and project directory
SCRIPT_DIR=$(dirname "$(realpath "$0")")
PROJECT_DIR=$(dirname "$SCRIPT_DIR")

# Get a list of staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

# Initialize variables
PYTHON_FILES_FOUND=0
PHP_FILES_FOUND=0

# Check for files with specific extensions
for FILE in $STAGED_FILES; do
    if echo "$FILE" | grep -q '\.py$'; then
        PYTHON_FILES_FOUND=1
        echo "Python file detected: $FILE"
    fi
    if echo "$FILE" | grep -q '\.php$'; then
        PHP_FILES_FOUND=1
        echo "PHP file detected: $FILE"
    fi
done

# Take action based on whether Python or PHP files were found
if [ $PYTHON_FILES_FOUND -eq 1 ] || [ $PHP_FILES_FOUND -eq 1 ]; then
    bash "$PROJECT_DIR/bin/create-file-hashes"
fi

# Exit successfully if everything worked
exit 0
