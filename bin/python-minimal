#!/usr/bin/env bash
set -e

# set variable
SCRIPT_DIR="$(dirname "$(realpath "$0")")"
CWD="$(dirname "$SCRIPT_DIR")"

# add bin to PATH
export PATH="$CWD/bin:$PATH"

# create venv if not exists
if [ ! -d "venv" ]; then
  if command -v python3 &> /dev/null; then
    python3 -m venv venv
    python3 -m pip install --upgrade pip
  elif command -v python &> /dev/null; then
    python -m venv venv
    python -m pip install --upgrade pip
  else
    echo "Python is not installed." >&2
    exit 1
  fi
fi

. venv/bin/activate
py -m pip install --upgrade pip || true
py -m pip install requests PySocks beautifulsoup4 lxml httpx pycryptodome python-dotenv
if [ -d "packages/proxy-checker-python" ]; then
  py -m pip install -e packages/proxy-checker-python
else
  py -m pip install git+https://github.com/dimaslanjaka/proxy-checker-python.git@master
fi
if [ -d "packages/proxy-hunter-python" ]; then
  py -m pip install -e packages/proxy-hunter-python
else
  py -m pip install git+https://github.com/dimaslanjaka/proxy-hunter-python.git@master#subdirectory=packages/proxy-hunter-python
fi
if [ -d "packages/rsa-utility" ]; then
  py -m pip install -e packages/rsa-utility
else
  py -m pip install git+https://github.com/dimaslanjaka/php-proxy-hunter.git@master#subdirectory=packages/rsa-utility
fi
